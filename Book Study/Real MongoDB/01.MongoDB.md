# MongoDB 버전
* 메이저번호.마이너번호.패치번호 => 3.2.2
* 마이너 번호가 짝수면 릴리즈 버전, 홀수면 개발 버전
  * 3.3.1(개발버전) -> 3.2.1(릴리즈버전)
  * 릴리즈버전의 마이너 번호가 더 낮음
## setFeatureCompatibilityVersion 옵션
* MongoDB의 버전업그레이드는 서비스를 중지하지 않고 레플리카 셋의 멤버들을 순차적으로 업그레이드합니다. 
* 진행 방식
  * 레플리카 셋의 모든 세컨드리 멤버의 버전 업그레이드
  * 업그레이드된 세컨드리 멤버와 프라이머리 스위칭 작업
  * 세컨드리가된 인스턴스 업그레이드
* 업그레이드 도중에 버전이 혼용되는 셋팅되어 있는 환경 구성 가능
  * 이때 최신 버전의 명령어를 사용하게되면 데이터가 깨지는 문제 발생 
  * 이 문제를 해결하기 위해서 업그레이드시 최신 버전의 명령어 사용 불가 상태 설정됨
  * 모든 업그레이드 완료시 setFeatureCompatibilityVersion 버전을 켜줘야함
```js
// 3.4 버전의 업그레이드가 모두 완료되면 아래 명령어를 통해서 업데이트된 버전의 명령어 사용이 가능하도록 수정
mongo> use admin
mongo> db.adminCommand({ setFeatureCompatibilityVersion : "3.4"})
```

## MongoDB 데이터 쿼리 결과 반환
* MongoDB는 쿼리 결과를 cursor로 반환함 
* 모든 데이터를 메모리에 담아두지 않고 페이지 사이즈 단위로 전송 받아서 처리합니다. 

## MongoDB 배포 형태
* 단일노드 
  * 자동 Fail-Over, HA(High Availability) 기능 불가 
    * HA(High Availability) : 클러스터링, 이중화, Raid 구성 
  * 일반적으로 개발 단계에서만 사용가능
* 단일 레플리카 셋
  * 1대의 프라이머리 노드와 세컨드리 노드로 구성됨
  * 읽기 쿼리는 세컨드리 노드로 요청 가능, 수정은 프라이머리에만
  * 보통 홀수로 지정해서 과반수가 투표가 가능한 상태인경우 Fail Over가능
  * 아비터 모드를 사용하면 투표만 전담으로 하는 서버를 구성할 수 있음(PBN은 이모드 사용)
* 샤딩된 클러스터 
  * 하나 이상의 레플리카 셋이 필요함
  * 각 레플리카 셋을 샤드라고 하며 자신만의 파티션된 데이터를 가지게 됩니다.
  * 각 샤드들이 어떤 데이터를 가지는지는 MongoDB Config서버가 관리합니다.
  * 샤딩된 클러스터 환경에서는 직접 MongoDB 서버로 연결하지 않고 라우터를 통해서 접근합니다. 


## mongo 참고 사항
* db.users.find({}).skip(20).limit(10);
* mongod를 구동하면 포트 번호 + 1000번으로 Web 관리 화면 표시 
* mongo 클라이언트에서 JavaScript 코드를 통해서 조작 할 수 있음
* 레플리카 세트는 프라이머리(변경), 세컨더리(참조)로 구분됨
* 프라이머리 -> Oplog DB -> 세컨더리 방식으로 데이터 복제 동기화
