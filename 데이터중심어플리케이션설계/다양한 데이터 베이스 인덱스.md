# MYSQL

## MYSQL의 INDEX 사용 방식
### 인덱스 내부 구조
* 대부분의 MYSQL 인덱스는 B-trees를 사용합니다. 
* SPATIAL 인덱스의 경우 R-tree를 사용하며 메모리 테이블은 hash 인덱스를 사용합니다. 

### MYSQL에서 인덱스 사용 목적
* Where절과 일치하는 행을 빠르게 검색
* Join을 수행시 다른 테이블의 행을 검색
* 인덱스된 컬럼의 MIN(), MAX() 찾기
* sort또는 group화합니다. 
* covering index(커버링 인덱스)
  * 경우에 따라서는 데이터 행을 참조하지 않고 값을 추출합니다.
  
#### 주의 할점 대부분 행에 엑세스 한다면 인덱스보다는  순차읽기가 더 빠릅니다.

## Covering index
* 쿼리가 요구하는 모든 컬럼을 포함하는 인덱스 
* 인덱스 page에서 모든 데이터를 가져올 수 있다면 데이터 page를 참조하지 않고 결과를 리턴할 수 있습니다.
* 특히 InnoDB의 secondary 인덱스의 경우 primary key를 포함하기 때문에 더욱 유용
```sql
CREATE TABLE
```

## Spatial index
* Spatial data인 2차원 데이터를 인덱싱하고 검색하는 인덱스입니다. 
* R-Tree 인덱스를 통해서 구현됩니다. 

### Spatial data
* mysql은 기하학적 도형의 정보를 저장할 수 있습니다.
* POINT, LINE, POLYGON, GEOMETRY 타입을 가지며 GEOMETRY은 POINT, LINE, POLYGON의 상위 타입으로 모든 타입을 저장할 수 있습니다.
```sql
POINT(15 20)
LINESTRING(0 0, 10 10, 20 25, 50 60)
POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7, 5 5))
MULTIPOINT(0 0, 20 20, 60 60)
```
### R-tree 알고리즘
* MBR(minimun Bounding Rectangle)의 포함 관계를 B-Tree형태로 구현한 인덱스입니다. 
* [R-tree 관련 설명 사이트](https://12bme.tistory.com/143)

## Fractal-Tree 인덱스
* TokuTek사에서 개발한 알고리즘(특허로 보호됨)
### 개발된 배경
* B-tree는 대규모 데이터 블록을 위해 개발되었지만 디스크 I/O에 의해서 제한됨
  * 그 이유는 대용량의 데이터 베이스의 크기가 RAM으로 감당할수 없으므로 대부분의 leave들을 사용하려면 I/O가 발생 
### 개선 방안
* B-Tree와 마찬가지로 fractal-Tree도 트리 구조이지만 각 내부 노드에는 버퍼가 존재합니다.
* 버퍼는 insert를 임시로 저장하며 buffer가 가득차면 자식 노드로 flush함
* 이렇게 한다면 디스크의 leave들에 메시지가 도달 할 때 I/O당 작은 write가 아니라 유용한 많은 작업들을 수행하도록 보장합니다. 
* 버퍼는 디스크에 직렬화 되므로 충돌이나 정전이 발생해도 메시지 손실이 발생하지 않습니다.
* 만약 복구 작업이 필요하면 로그를 통해서 복구 할 수 있습니다.
* 참고 사이트
  * https://www.percona.com/doc/percona-tokudb/ft-index.html
  * https://gywn.net/2014/05/fractal-index-in-tokudb/


#### [링크 사이트](https://medium.com/@hmj2088/mysql-tokudb-rocksdb-and-innodb-ae90bda34cea)

## InnoDB의 제한 사항
* 테이블은 최대 1017개의 컬럼을 가질 수 있습니다. 
* 최대 64개의 secondary index를 가질 수 있습니다. 
* 페이지의 크기에 따라서 인덱스 키의 접두사 제한이 달라집니다. 
* 최소 table space의 크기는 10MB보다 약간 큽니다.

|page size|index prefix|tablespace size|
|:--:|:--:|:--:|
|4kb|768byte|16TB|
|8kb|1536byte|32TB|
|16kb|3072byte|64TB|
|32kb|3072byte|128TB|
|64kb|3072byte|256TB|


* multi-컬럼 인덱스는 최대 16개의 컬럼을 허용합니다. 
#### table space란 하나 또는 여러개의 데이터 파일로 구성된 논리적인 데이터 저장구조

#### 참조 사이트
* https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html
* https://www.percona.com/doc/percona-tokudb/ft-index.html


# 레디스

# MongoDB

# 카산드라